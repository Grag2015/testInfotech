## Анализ результатов А/Б-тестирования.

выполнил: *Григорий Михолап*  
дата: *20/01/2016*

```{r setoptions, echo=FALSE, warning=FALSE, message=FALSE}
# глобальные настройки для chunks
library(knitr)
opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r  echo=FALSE, results='hide', warning=FALSE, message=FALSE}
# Подключаем нужные библиотеки
library("dplyr")
library("ggplot2")
library("lattice") 
library("xtable")
library("car")
library(lubridate)
library(reshape2)
library(exactci)
```

**Задание:**
Было принято решение провести А/Б тестирование в игре, одной группе пользователей показывали рекламу как обычно, другой не показывали вообще, и после этого были получены результаты, представленные на вкладке «А/Б тестирование». Эксперимент длился 4 недели. Сделайте выводы и дайте рекомендации.


**Выводы кратко:** 


**Замечание** по поводу программного кода:
Программный код, который используется в отчете можно найти [по ссылке](https://github.com/) 

## Анализ показателя "Paying Users"

group  | Total New Users  | Paying Users  | Rate1 = Paying/Total
------------- | ------------- | ------------- | -------------
with ads | `18930` | `980` | `r round(980/18930,4)*100`%
without ads  | `16180`  | `420`  | `r round(420/16180,4)*100`%

Я добавил дополнительный столбец `Rate1`, в котором рассчитал долю игроков, которые произвели платеж (т.н. конверсию в платеж). Мы видим, что в группе с рекламой конверсия в платящих игроков выше (см. столбец Rate1), проверим является ли это различие статистически значимым либо оно просто вызвано случайными колебаниями.
Для начала мы предполагаем, что события "Пользователь оплатил" и "Пользователь не оплатил" подчиняются Биноминальному распределению. Для группы "with ads" мы имеем биноминальное распределение с параметром "вероятность успеха" равным `r round(980/18930,4)`, а для группы "without ads" - `r round(420/16180,4)`  
Теперь нам необходимо проверить, какая из гипотез верна:  
* Нулевая гипотеза Н0 - конверсии равны.
* Альтернативная гипотеза - конверсии не равны.
Теперь, рассчитаем вероятность получить указанные в таблице результаты, при условии, что верна нулевая гипотеза.

```{r echo=T}
test <- binom.test(x=420, n=16180, p = 0.0518, conf.level = 0.99)
test$p.value
```
Мы видим, что эта вероятность практически равна нулю, что дает нам основание отвергнуть нулевую гипотезу о равенстве конверсий и заявить, что конверсии значимо различаются.

Рассчитаем 99%-доверительные интервалы для оценок наших конверсий.  
with ads
```{r echo=T}
binom.test(980, 18930, conf.level = 0.99)$conf.int
```

without ads
```{r echo=T}
binom.test(420, 16180, conf.level = 0.99)$conf.int
```
Мы видим, что доверительные интервалы не пересекаются, что еще раз подтверждает правильность результатов теста. И мы можем сказать, что в среднем вариант с рекламой в среднем конвертирует  в `2 (=5.18/2.6)` раза лучше, чем вариант без рекламы, при этом доверительный интервал для данной оценки составляет `(1.6-2.5)`.

**Замечание** по поводу объема выборки - для получения статистически значимых результатов для оценки уровня конверсии достаточно выборки гораздо меньшего размера - в 5-10 раз меньше.

## Анализ показателя "Count in App Purchases"
group  | Total New Users  | Paying Users  | Count in App Purchases  | Rate2 = Purchases/Paying  | lambda
------------- | ------------- | ------------- | ------------- | ------------- | -------------
with ads | `18930` | `980` | `1200` | `r round(1200/980,2)` | `r round(1200/18930,4)`
without ads  | `16180`  | `420`  | `1500`  | `r round(1500/420,2)` | `r round(1500/16180,4)`

**Замечание**: для анализа этого показателя лучше всего иметь полные данные наблюдений (а не только агрегированные показатели), чтобы понимать характер распределения, которому подчиняются эти данные.

В настоящих же услових, мы можем предположить, что количество покупок подчиняется закону распределения Пуассона с параметром lambda, рассчитанным в таблице выше по формуле `Count in_App Purchases/Total New Users`. 

Замечанние 2: Распределение Пуассона является дискретным и принимает любые целые неотрицательные значения `n= 0, 1, 2, 3,...`  с заданными вероятностями `p(n)=lambda^n*exp^(-lambda)/n!`. Для проверки насколько наше предположение о распределении Пуассона соответствует действительно мы можем рассчитать веротность p(0) и сравнить с долей пользователей, которые сделали 0 покупок.
```{r}
lambda1 <- round(1200/18930,4)
lambda2 <- round(1500/16180,4)
```
теоретические вероятности
```{r echo=T, results='hold'}
lambda1^0*exp(-lambda1) # with ads
lambda2^0*exp(-lambda2) # without ads
```
доли пользователей, которые сделали 0 покупок
```{r echo=T, results='hold'}
round((18930-980)/18930,4) # with ads
round((16180-420)/16180,4) # without ads
```
Как видим для первого случая эти числа практически равны, для второго не так близки, но тоже похожи.
Это подтверждает правильность нашего выбора распределения.

Рассчитанные для обоих случаев параметры `lambda` кроме того указывают среднее число покупок, совершенных одним пользователем. Для удобства можем говорить о среднем числе покупок, совершенных 100 пользователями, и мы видим, что в случае с рекламой 100 пользователей сделают 6 покупок, а в случае без рекламы 100 пользователей сделаю 9 покупок, т.е. в полтора раза больше.

Далее, проверим, как в первом случае, является ли это различие статистически значимым либо оно просто вызвано случайными колебаниями.
```{r}
test <- poisson.test(x = c(1500,1200), T = c(16180,18930))
test$p.value
```
Как видим различия статистически значимы (т.к. `p-value<<0.05`) и можно говорить, что в случае без рекламы пользователи делают покупок в среднем в 1.45 раза (доверительный интервал для этого коэффициента (`r round(test$conf.int,2)`))

Рассчитаем доверительные интервалы для оценок среднего числа покупок.  
with ads
```{r}
poisson.test(x = c(1200), T = c(18930))$p.value
```

without ads
```{r}
poisson.test(x = c(1500), T = c(16180))$p.value
```
Как видим доверительные интервалы не пересекаются, что также подтверждает вывод о статистической значимости.

## Анализ показателя "in App Revenue"

group  | Total New Users  | Count in App Purchases  | in App Revenue  | Rate1=Revenue/Purchases  | Rate2=Revenue/Users
------------- | ------------- | ------------- | ------------- | ------------- | -------------
with ads | `18930` | `1200` | `4200` | `r round(4200/1200,2)` | `r round(4200/18930,2)`
without ads  | `16180`  | `1500`  | `3800` | `r round(3800/1500,2)` | `r round(3800/16180,2)`

Каждая покупка в случае без рекламы была дешевле 2.5 vs 3.5, но выше мы обнаружили, что в среднем пользователи без рекламы совершали больше покупок и поэтому ожидаемый результат - в среднем на одного пользовател без рекламы доход составил 0,23 у.е. против 0,22 у.е. с пользователя с рекламой.

**Результат:** спрогнозированное на июнь количество регистраций по каналу `D` равно `r round(220+6.32*11)` и доверительный интервал для данной оценки равен 
    
    
 ___________   

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
# knit2html('Task 3 Advert channels.Rmd', encoding="UTF-8")
# browseURL('Task 3 Advert channels.Rmd')

```

